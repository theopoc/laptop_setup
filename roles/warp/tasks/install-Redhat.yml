---
- name: Install Warp terminal (Red Hat/Fedora)
  when: warp_enabled | bool
  block:
    - name: Download Warp RPM package
      ansible.builtin.get_url:
        url: "{{ warp_download_url }}"
        dest: "/tmp/warp-terminal.rpm"
        mode: "0644"
      retries: 3
      delay: 5
      until: warp_rpm_download is succeeded
      register: warp_rpm_download

    - name: Install Warp RPM package
      ansible.builtin.dnf:
        name: "/tmp/warp-terminal.rpm"
        state: "{{ warp_rpm_state }}"
      become: true
      register: warp_dnf_result
  rescue:
    - name: Clean up downloaded RPM package
      ansible.builtin.file:
        path: "/tmp/warp-terminal.rpm"
        state: absent
