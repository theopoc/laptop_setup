---
# roles/claude-code/tasks/install-Debian.yml
# Ubuntu/Debian-specific installation tasks for Claude Code

- name: Ensure curl is installed
  ansible.builtin.apt:
    name: curl
    state: present
    update_cache: true
  become: true
  tags: ["claude-code"]

- name: Check if Claude Code binary already exists
  ansible.builtin.stat:
    path: "{{ claude_code_binary_path }}"
  register: claude_binary
  tags: ["claude-code"]

- name: Install Claude Code via curl script with retry logic
  ansible.builtin.shell:
    cmd: curl -fsSL {{ claude_code_install_script_url }} | bash
  args:
    creates: "{{ claude_code_binary_path }}"
  register: curl_install_result
  retries: 3
  delay: 5
  until: curl_install_result.rc == 0
  when: not claude_binary.stat.exists
  tags: ["claude-code"]
